{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 800,
  "autosize": { "type": "fit", "contains": "padding" },
  "projection": {
    "type": "albers",
    "parallels": [-18, -36],
    "rotate": [-132, 0, 0],
    "center": [0, -27]
  },
  "layer": [
    {
      "data": {
        "graticule": {
          "step": [10, 10],
          "extent": [[110, -45], [155, -9]]
        }
      },
      "mark": {
        "type": "geoshape",
        "stroke": "#86888a",
        "strokeOpacity": 0.9,
        "strokeWidth": 0.7,
        "filled": false
      }
    },
    {
      "data": {
        "url": "aus-states.topo.json",
        "format": {
          "type": "topojson",
          "feature": "STE_2021_AUST_GDA2020"
        }
      },
      "mark": {
        "type": "geoshape"
      },
      "encoding": {
        "color": {"value": "#f7f9fb"},
        "stroke": {"value": "#dfe6ee"},
        "strokeWidth": {"value": 0.8}
      }
    },
    {
      "data": {
        "values": [
          {"state": "New South Wales", "lon": 147.0, "lat": -32.8},
          {"state": "Victoria", "lon": 144.6, "lat": -36.6},
          {"state": "Queensland", "lon": 146.5, "lat": -20.5},
          {"state": "South Australia", "lon": 135.7, "lat": -30.3},
          {"state": "Western Australia", "lon": 122.0, "lat": -25.5},
          {"state": "Tasmania", "lon": 146.8, "lat": -42.0},
          {"state": "Northern Territory", "lon": 133.8, "lat": -19.0},
          {"state": "Australian Capital Territory", "lon": 149.0, "lat": -35.4}
        ]
      },
      "transform": [
        {
          "lookup": "state",
          "from": {
            "data": {"url": "state_aggregates.csv"},
            "key": "state_full",
            "fields": ["meter_count", "avg_occupancy", "avg_rate", "population", "rate_per_100k"]
          }
        },
        {
          "calculate": "isValid(datum.meter_count) ? datum.meter_count : 0",
          "as": "count"
        }
      ],
      "mark": {
        "type": "circle",
        "opacity": 0.85,
        "stroke": "white",
        "strokeWidth": 1
      },
      "encoding": {
        "longitude": {"field": "lon"},
        "latitude": {"field": "lat"},
        "size": {
          "field": "count",
          "type": "quantitative",
          "title": "Parking meters (absolute count, 2025)",
          "scale": {"type": "sqrt", "range": [60, 1500]},
          "legend": {
            "titleLimit": 260,
            "symbolFillColor": "#1b6ca8",
            "symbolStrokeColor": "white"
          }
        },
        "color": {"value": "#1b6ca8"}
      }
    },
    {
      "data": {
        "values": [
          {"abbr": "NSW", "lon": 147.2, "lat": -33.3},
          {"abbr": "VIC", "lon": 145.0, "lat": -37.1},
          {"abbr": "QLD", "lon": 146.9, "lat": -21.2},
          {"abbr": "SA", "lon": 137.2, "lat": -31.2},
          {"abbr": "WA", "lon": 122.7, "lat": -26.6},
          {"abbr": "TAS", "lon": 147.0, "lat": -42.4},
          {"abbr": "NT", "lon": 134.2, "lat": -20.3},
          {"abbr": "ACT", "lon": 149.4, "lat": -35.7}
        ]
      },
      "mark": {
        "type": "text",
        "font": "'Segoe UI', Arial, Helvetica, sans-serif",
        "fontSize": 15,
        "fontWeight": 600,
        "baseline": "middle",
        "align": "center",
        "fill": "#0f172a"
      },
      "encoding": {
        "longitude": {"field": "lon"},
        "latitude": {"field": "lat"},
        "text": {"field": "abbr"}
      }
    },
    {
      "data": {
        "url": "aus-states.topo.json",
        "format": {
          "type": "topojson",
          "feature": "STE_2021_AUST_GDA2020"
        }
      },
      "mark": {
        "type": "geoshape",
        "filled": false,
        "stroke": "#c6d3dd",
        "strokeWidth": 1
      }
    },
    {
      "data": {
        "values": [
          {"state": "New South Wales", "lon": 147.0, "lat": -32.8},
          {"state": "Victoria", "lon": 144.6, "lat": -36.6},
          {"state": "Queensland", "lon": 146.5, "lat": -20.5},
          {"state": "South Australia", "lon": 135.7, "lat": -30.3},
          {"state": "Western Australia", "lon": 122.0, "lat": -25.5},
          {"state": "Tasmania", "lon": 146.8, "lat": -42.0},
          {"state": "Northern Territory", "lon": 133.8, "lat": -19.0},
          {"state": "Australian Capital Territory", "lon": 149.0, "lat": -35.4}
        ]
      },
      "transform": [
        {
          "lookup": "state",
          "from": {
            "data": {"url": "state_aggregates.csv"},
            "key": "state_full",
            "fields": ["meter_count", "avg_occupancy", "avg_rate", "population", "rate_per_100k"]
          }
        },
        {
          "calculate": "datum.meter_count",
          "as": "count"
        },
        {
          "joinaggregate": [{"op": "sum", "field": "meter_count", "as": "national_total"}]
        },
        {
          "window": [{"op": "rank", "as": "rank"}],
          "sort": [{"field": "meter_count", "order": "descending"}]
        },
        {
          "calculate": "datum.meter_count / datum.national_total * 100",
          "as": "share_pct"
        }
      ],
      "mark": {
        "type": "circle",
        "opacity": 0
      },
      "encoding": {
        "longitude": {"field": "lon"},
        "latitude": {"field": "lat"},
        "size": {"field": "count", "type": "quantitative"},
        "tooltip": [
          {"field": "state", "title": "State/Territory"},
          {"field": "meter_count", "title": "Parking Meters", "format": ","},
          {"field": "population", "title": "Population", "format": ","},
          {"field": "avg_occupancy", "title": "Avg Occupancy %", "format": ".1f"},
          {"field": "avg_rate", "title": "Avg Rate/Hour ($)", "format": ".2f"},
          {"field": "rate_per_100k", "title": "Rate /100k", "format": ".2f"},
          {"field": "share_pct", "title": "Share of national total (%)", "format": ".1f"},
          {"field": "rank", "title": "Rank (by count)", "format": "d"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {"state": "Victoria", "annotation": "VIC: 1,200 meters", "subtext": "52.8% of national total"}
        ]
      },
      "layer": [
        {
          "mark": {
            "type": "rule",
            "strokeWidth": 3,
            "stroke": "#0ea5e9",
            "strokeDash": [8, 5]
          },
          "encoding": {
            "x": {"value": 420},
            "y": {"value": 420},
            "x2": {"value": 540},
            "y2": {"value": 540}
          }
        },
        {
          "mark": {
            "type": "circle",
            "size": 4000,
            "fill": "#ffffff",
            "stroke": "#0ea5e9",
            "strokeWidth": 3,
            "opacity": 0.98
          },
          "encoding": {
            "x": {"value": 650},
            "y": {"value": 590}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 18,
            "fontWeight": 800,
            "fill": "#0f172a"
          },
          "encoding": {
            "x": {"value": 650},
            "y": {"value": 583},
            "text": {"field": "annotation"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 15,
            "fontWeight": 700,
            "fill": "#0ea5e9"
          },
          "encoding": {
            "x": {"value": 650},
            "y": {"value": 603},
            "text": {"field": "subtext"}
          }
        }
      ]
    },
    {
      "data": {
        "values": [
          {"state": "Queensland", "annotation": "QLD: 1,038 meters", "subtext": "45.7% of national total"}
        ]
      },
      "layer": [
        {
          "mark": {
            "type": "rule",
            "strokeWidth": 3,
            "stroke": "#8b5cf6",
            "strokeDash": [8, 5]
          },
          "encoding": {
            "x": {"value": 490},
            "y": {"value": 160},
            "x2": {"value": 610},
            "y2": {"value": 80}
          }
        },
        {
          "mark": {
            "type": "circle",
            "size": 4000,
            "fill": "#ffffff",
            "stroke": "#8b5cf6",
            "strokeWidth": 3,
            "opacity": 0.98
          },
          "encoding": {
            "x": {"value": 720},
            "y": {"value": 50}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 18,
            "fontWeight": 800,
            "fill": "#0f172a"
          },
          "encoding": {
            "x": {"value": 720},
            "y": {"value": 43},
            "text": {"field": "annotation"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 15,
            "fontWeight": 700,
            "fill": "#8b5cf6"
          },
          "encoding": {
            "x": {"value": 720},
            "y": {"value": 63},
            "text": {"field": "subtext"}
          }
        }
      ]
    },
    {
      "data": {
        "values": [
          {"annotation": "Together VIC + QLD", "subtext": "account for 98.5% of", "subtext2": "all parking meters"}
        ]
      },
      "layer": [
        {
          "mark": {
            "type": "rect",
            "fill": "#fef3c7",
            "stroke": "#f59e0b",
            "strokeWidth": 3,
            "cornerRadius": 12,
            "opacity": 0.98
          },
          "encoding": {
            "x": {"value": 30},
            "y": {"value": 600},
            "x2": {"value": 300},
            "y2": {"value": 710}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 19,
            "fontWeight": 900,
            "fill": "#92400e"
          },
          "encoding": {
            "x": {"value": 165},
            "y": {"value": 633},
            "text": {"field": "annotation"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 16,
            "fontWeight": 700,
            "fill": "#78350f"
          },
          "encoding": {
            "x": {"value": 165},
            "y": {"value": 658},
            "text": {"field": "subtext"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "center",
            "fontSize": 16,
            "fontWeight": 700,
            "fill": "#78350f"
          },
          "encoding": {
            "x": {"value": 165},
            "y": {"value": 680},
            "text": {"field": "subtext2"}
          }
        }
      ]
    }
  ],
  "title": {
    "text": "Parking Meters â€” Absolute Counts by State/Territory (2025)",
    "anchor": "start",
    "fontSize": 22,
    "fontWeight": 700,
    "color": "#0f172a",
    "subtitle": "Circle size proportional to total parking meter count in each state",
    "subtitleFontSize": 14,
    "subtitleColor": "#475569",
    "subtitleFontWeight": 500
  },
  "config": {
    "view": {"stroke": null},
    "font": "Helvetica, 'Segoe UI', Arial, sans-serif",
    "title": {
      "font": "Helvetica, 'Segoe UI', Arial, sans-serif",
      "fontSize": 20,
      "fontWeight": 600
    },
    "axis": {
      "labelFont": "Helvetica, 'Segoe UI', Arial, sans-serif",
      "titleFont": "Helvetica, 'Segoe UI', Arial, sans-serif",
      "labelColor": "#0f172a",
      "titleColor": "#0f172a"
    },
    "legend": {
      "orient": "right",
      "labelFontSize": 14,
      "labelColor": "#0f172a",
      "titleColor": "#0f172a",
      "titleFontWeight": 700,
      "titleFontSize": 15,
      "gradientLength": 200,
      "titleLimit": 300,
      "labelLimit": 300,
      "symbolSize": 320,
      "symbolType": "circle",
      "labelFontWeight": 600
    }
  }
}
